<script type="text/javascript">
$.fn.toggle = function( fn, fn2 ) {
    var args = arguments,guid = fn.guid || $.guid++,i=0,
    toggle = function( event ) {
      var lastToggle = ( $._data( this, "lastToggle" + fn.guid ) || 0 ) % i;
      $._data( this, "lastToggle" + fn.guid, lastToggle + 1 );
      event.preventDefault();
      return args[ lastToggle ].apply( this, arguments ) || false;
    };
    toggle.guid = guid;
    while ( i < args.length ) {
      args[ i++ ].guid = guid;
    }
    return this.click( toggle );
}
function wli(){
	var wsp0=0;
	var wsp=$('.content_ul_w ul li').eq(0).children('span');
	for( var i=0; i<wsp.length;i++){
		wsp0+=wsp.eq(i).outerWidth();
	}
	$('.content_ul_w ul li').css('width',wsp0);	
}
wli();

//全选
$('#all').click(function(){
	if(this.checked){                                     
		$("[name='id[]']:checkbox").prop("checked",true);  
	}else{
		$("[name='id[]']:checkbox").prop("checked",false);  
	}	
});

//checkbox
$("#qk").click(function(){
	$('input[type="checkbox"]').prop({
        checked: false
      })	
})
$('input[type="checkbox"]').change(function(e) {

  var checked = $(this).prop("checked"),
      container = $(this).parent(),
      siblings = container.siblings();

  container.find('input[type="checkbox"]').prop({
    indeterminate: false,
    checked: checked
  });

  function checkSiblings(el) {

    var parent = el.parent().parent(),
        all = true;

    el.siblings().each(function() {
      return all = ($(this).children('input[type="checkbox"]').prop("checked") === checked);
    });

    if (all && checked) {

      parent.children('input[type="checkbox"]').prop({
        indeterminate: false,
        checked: checked
      });

      checkSiblings(parent);

    } else if (all && !checked) {

      parent.children('input[type="checkbox"]').prop("checked", checked);
      parent.children('input[type="checkbox"]').prop("indeterminate", (parent.find('input[type="checkbox"]:checked').length > 0));
      checkSiblings(parent);

    } else {

      el.parents("li").children('input[type="checkbox"]').prop({
        indeterminate: true,
        checked: false
      });

    }

  }

  checkSiblings(container);
});



$(".gs_title2 li img").each(function(){
	$(this).toggle(function(){
		$(this).attr('src','__PUBLIC__/img/hl.png')
		$(this).parent('li').children('ul').slideDown()
	},function(){
		$(this).attr('src','__PUBLIC__/img/zk.png')	
		$(this).parent('li').children('ul').slideUp()
	})
})
$("#qk1").click(function(){
	$(".gs_c .gs_title2 [name='company_id[]']:checkbox:checked").each(function(){
		$(this).prop('checked',false);
	})
	$("#company_id").val('');
	$("#gs").val('');
})
$("#qk2").click(function(){
	$(".bm_c .gs_title2 [name='dept_id[]']:checkbox:checked").each(function(){
		$(this).prop('checked',false);
	})
	$("#dept_id").val('');
	$("#bm").val('');
})
$("#qk3").click(function(){
	$(".gw_c .gs_title2 [name='position_id[]']:checkbox:checked").each(function(){
		$(this).prop('checked',false);
	})
	$("#position_id").val('');
	$("#gw").val('');
})

$("#gb1").click(function(){
	$(".gs_c").slideUp()	
})
$("#gb2").click(function(){
	$(".bm_c").slideUp()	
})
$("#gb3").click(function(){
	$(".gw_c").slideUp()	
})
$('#gs').click(function(){
	$(".gs_c").slideDown();
})
$('#bm').click(function(){
	$(".bm_c").slideDown();
})
$('#gw').click(function(){
	$(".gw_c").slideDown();
})

$(function(){
	$('#gs').click(function(){
		$(".gs_c").slideDown();
	})
    var M1 = $('.gs_a')
    M1.on('click',function(e){e.stopPropagation();})
    .find('div[class="ss"]').on('click',function(){
        M1.find('.gs_c').show();
    });
    $(document).on('click',function(){M1.find('.gs_c').hide()})
})
$(function(){
	$('#bm').click(function(){
		$(".bm_c").slideDown();
	})
    var M1 = $('.bm_a')
    M1.on('click',function(e){e.stopPropagation();})
    .find('div[class="ss"]').on('click',function(){
        M1.find('.bm_c').show();
    });
    $(document).on('click',function(){M1.find('.bm_c').hide()})
})
$(function(){
	$('#gw').click(function(){
		$(".gw_c").slideDown();
	})
    var M1 = $('.gw_a')
    M1.on('click',function(e){e.stopPropagation();})
    .find('div[class="ss"]').on('click',function(){
        M1.find('.gw_c').show();
    });
    $(document).on('click',function(){M1.find('.gw_c').hide()})
})

$("#qr1").click(function(){
	var company_name = '';
	var company_id = '';
	$(".gs_c .gs_title2 [name='company_id[]']:checkbox:checked").each(function(){
		company_name += $(this).next().html()+',';
		company_id += $(this).val()+',';
	})
	$("#company_id").val(company_id);
	$("#gs").val(company_name);
	$(".gs_c").slideUp();
	$.ajax({
		type:'post',
		url:"{:U('get_dept_search_html')}",
		data:{company_id:company_id},
		success:function(result){
			$(".bm_c .gs_title2").html(result.data);
			$(".gw_c .gs_title2").html('');
			
			$(".bm_c .gs_title2 li img").each(function(){
				$(this).toggle(function(){
					$(this).attr('src','__PUBLIC__/img/hl.png')
					$(this).parent('li').children('ul').slideDown()
				},function(){
					$(this).attr('src','__PUBLIC__/img/zk.png')	
					$(this).parent('li').children('ul').slideUp()
				})
			})
		},
		error:function(){
			alert('数据错误');
		}
	})
})
$("#qx1").click(function(){
	$(".gs_c .gs_title2 [name='company_id[]']:checkbox:checked").each(function(){
		$(this).prop('checked',false);
	})
	$("#company_id").val('');
	$("#gs").val('');
	$(".gs_c").slideUp()	
})
$("#qr2").click(function(){
	var dept_name = '';
	var dept_id = '';
	$(".bm_c .gs_title2 [name='dept_id[]']:checkbox:checked").each(function(){
		dept_name += $(this).next().html()+',';
		dept_id += $(this).val()+',';
	})
	$("#dept_id").val(dept_id);
	$("#bm").val(dept_name);
	$(".bm_c").slideUp();
	$.ajax({
		type:'post',
		url:"{:U('get_position_search_html')}",
		data:{dept_id:dept_id},
		success:function(result){
			$(".gw_c .gs_title2").html(result.data);
		},
		error:function(){
			alert('数据错误');
		}
	})
})
$("#qx2").click(function(){
	$(".bm_c .gs_title2 [name='dept_id[]']:checkbox:checked").each(function(){
		$(this).prop('checked',false);
	})
	$("#dept_id").val('');
	$("#bm").val('');
	$(".bm_c").slideUp()	
})
$("#qr3").click(function(){
	var position_name = '';
	var position_id = '';
	$(".gw_c .gs_title2 [name='position_id[]']:checkbox:checked").each(function(){
		position_name += $(this).next().html()+',';
		position_id += $(this).val()+',';
	})
	$("#position_id").val(position_id);
	$("#gw").val(position_name);
	$(".gw_c").slideUp()	
})
$("#qx3").click(function(){
	$(".gw_c .gs_title2 [name='position_id[]']:checkbox:checked").each(function(){
		$(this).prop('checked',false);
	})
	$("#position_id").val('');
	$("#gw").val('');
	$(".gw_c").slideUp()	
})

function change_dept(company_id){
	$.ajax({
		type:'post',
		url:"{:U('get_dept_html')}",
		data:{company_id:company_id},
		success:function(result){
			$("#dept").html(result.data.dept);
			$("#position").html('');
		},
		error:function(){
			alert('数据错误');
		}
	})
}
function change_position(dept_id){
	$.ajax({
		type:'post',
		url:"{:U('get_position_html')}",
		data:{dept_id:dept_id},
		success:function(result){
			$("#position").html(result.data.position);
		},
		error:function(){
			alert('数据错误');
		}
	})
}
function set_recruit_status(id,status){
	if(status == '1'){
		var msg = '确定要报到吗？';
	}else if(status == '2'){
		var msg = '确定要建档吗？';
	}else if(status == '3'){
		var msg = '确定要未报到吗？';
	}
	ui_confirm(msg, function() {
		$.ajax({
			type:'post',
			url:"{:U('set_recruit_status')}",
			data:{id:id,status:status},
			success:function(result){
				if(result.status == '1'){
					location.reload();
				}
			},
			error:function(){
				alert('数据错误');
			}
		})
	});
}
function add() {
	$("#opmode").val("add");
	$("#id").val("");
	if (check_form("form_data")){
		sendForm("form_data", "{:U('save')}", "__SELF__");
	}
};

function del() {
	var vars = $("#form_data").serialize();
	ui_confirm('确定要删除吗?',function(){
		sendAjax("{:U('del')}", vars, function(data){
			if (data.status) {
				ui_alert(data.info,function(){
					location.reload();
				});
			}
		});
	})
}

function save() {
	if (check_form("form_data")) {
		sendForm("form_data", "{:U('save')}", "__SELF__");
	}
}

</script>