<script>
//JavaScript Document

function wli(){
	var wsp0=0;
	var wsp=$('.content_ul_w ul li').eq(0).children('span');
	for( var i=0; i<wsp.length;i++){
		wsp0+=wsp.eq(i).outerWidth();
	}
	$('.content_ul_w ul li').css('width',wsp0);	
}
wli();

$('#a_lbtj').click(function(){
	$('#tc_xzlc').show();
	$(".bottom_sp3,.bottom_sp4").click(function(){
		$("#tc_xzlc").hide();	
	});
});
$(".content_a").click(function(){
	$("#tc_bjlc").show();
	$(".bottom_sp3,.bottom_sp4").click(function(){
		$("#tc_bjlc").hide();	
	})	
})
$('#all').click(function(){
	if(this.checked){                                     
		$("[name='id[]']:checkbox").prop("checked",true);  
	}else{
		$("[name='id[]']:checkbox").prop("checked",false);  
	}	
});
function del() {
	var vars = $("#form_data_scwf").serialize();
	ui_confirm('确定要删除吗?',function(){
	sendAjax("{:U('del')}", vars, function(data) {
	if (data.status) {
		ui_alert(data.info,function(){
			$("input[name='id[]']:checkbox:checked").each(function() {
			$(this).parents("li").remove();
					});
				});				
			}
		});
	});
}

function change_module(name){
	$(".flow_name_tj option").remove();
	$.ajax({
		type:'post',
		data:{name:name},
		async:false,
		url:"{:U('getFlowNameByModuleName')}",
		success:function(data){
			$(".flow_name_tj").append(data.info);
		},
		error:function(){
			
		}
	})
	/* if(name == "人力资源"){
		var html='';
		html += "<option value=''>请选择</option>";
		html += "<option value='部门招聘需求申请'>部门招聘需求申请</option>";
		html += "<option value='加班申请'>加班申请</option>";
		html += "<option value='员工请假申请'>员工请假申请</option>";
		html += "<option value='出勤异常申请'>出勤异常申请</option>";
		html += "<option value='外勤/出差申请'>外勤/出差申请</option>";
		html += "<option value='员工调动申请'>员工调动申请</option>";
		html += "<option value='试用期评估表'>试用期评估表</option>";
		html += "<option value='员工转正申请'>员工转正申请</option>";
		html += "<option value='员工离职申请'>员工离职申请</option>";
		html += "<option value='员工离职交接申请'>员工离职交接申请</option>";
		html += "<option value='员工调薪申请'>员工调薪申请</option>";
		$(".flow_name_tj").append(html);
	}else{
		
		var html='';
		html += "<option value=''>请选择</option>";
		html += "<option value='私车公用申请'>私车公用申请</option>";
		html += "<option value='公交卡使用申请'>公交卡使用申请</option>";
		html += "<option value='物品采购调拨申请'>物品采购调拨申请</option>";
		html += "<option value='办公用品采购申请'>办公用品采购申请</option>";
		html += "<option value='办公用品领用申请'>办公用品领用申请</option>";
		html += "<option value='公司新闻与今日头条'>公司新闻与今日头条</option>";
		html += "<option value='文件审批申请'>文件审批申请</option>";
		html += "<option value='内部联络单'>内部联络单</option>";
		html += "<option value='名片申请'>名片申请</option>";
		html += "<option value='合同申请'>合同申请</option>";
		html += "<option value='公章申请'>公章申请</option>";
		html += "<option value='人事任命、业务提成申请'>人事任命、业务提成申请</option>";
		html += "<option value='会务申请'>会务申请</option>";
		$(".flow_name_tj").append(html);
	} */
}
$(".mkfl_name_tj").change(function(){
	var module_name = $(".mkfl_name_tj").val();
	change_module(module_name);
});

function show(id,module_name,flow_name,table_name,approve_url,look_url,approve_display,is_use,is_refactor,form_fields,is_emerg,flow_type_id){
	$("#workflow_id").val(id);
	$("#mkfl_name option").each(function(){
		if($(this).val() == module_name){
			$(this).prop('selected','true');
		}
	})
	change_module(module_name);
	$("#flow_name option").each(function(){
		if($(this).val() == flow_name){
			$(this).prop('selected','true');
		}
	})
	$("#flow_type_id").val(flow_type_id);
	$("#table_name").val(table_name);
	$("#approve_url").val(approve_url);
	$("#look_url").val(look_url);
	$("#approve_display option").each(function(){
		if($(this).val() == approve_display){
			$(this).prop('selected','true');
		}
	})
	$("#is_use option").each(function(){
		if($(this).val() == is_use){
			$(this).prop('selected','true');
		}
	})
	$("#is_refactor option").each(function(){
		if($(this).val() == is_refactor){
			$(this).prop('selected','true');
		}
	})
	$("#form_fields").val(form_fields);
	$("#is_emerg option").each(function(){
		if($(this).val() == is_emerg){
			$(this).prop('selected','true');
		}
	})
}
function save(){
	var id=$("#workflow_id").val();
	var flow_type_id = $("#flow_type_id").val();
	var module_name=$("#mkfl_name").val();
	var flow_name=$("#flow_name").val();
	var table_name=$("#table_name").val();
	var approve_url=$("#approve_url").val();
	var look_url=$("#look_url").val();
	var approve_display=$("#approve_display").val();
	var is_use=$("#is_use").val();
	var is_refactor=$("#is_refactor").val();
	var form_fields=$("#form_fields").val();
	var is_emerg=$("#is_emerg").val();
	//alert(id);
	$.ajax({
		type: "post",
		url: "{:U('edit')}",    
		data:{id:id,module_name:module_name,flow_name:flow_name,table_name:table_name,approve_url:approve_url,look_url:look_url,approve_display:approve_display,is_use:is_use,is_refactor:is_refactor,form_fields:form_fields,is_emerg:is_emerg,flow_type_id:flow_type_id},
		dataType: "json",
		success:function(result){
			if(result.data){
				ui_alert("编辑成功",function(){
					location.reload();
				});
			}else{
				ui_alert('编辑失败',function(){
					location.reload();
				});	
			}
		},
		error:function(e){
			ui_alert("系统发生错误",function(){
				location.reload();
			});
		}
	});
}

</script>
