<script>
function wli(){
	var wsp0=0;
	var wsp=$('.content_ul_w ul li').eq(0).children('span');
	for( var i=0; i<wsp.length;i++){
		wsp0+=wsp.eq(i).outerWidth();
	}
	$('.content_ul_w ul li').css('width',wsp0);	
}
wli();

$('#a_lbtj').click(function(){
	$('#tc_xztypz').show();
	$(".bottom_sp3,.bottom_sp4").click(function(){
		$("#tc_xztypz").hide();	
	});
});
$('.content_bj').click(function(){
	$('#tc_xztypzbj').show();
	$(".bottom_sp3,.bottom_sp4").click(function(){
		$("#tc_xztypzbj").hide();	
	});
});
$('.content_fz').click(function(){
	$('#tc_xztypzfz').show();
	$(".bottom_sp3,.bottom_sp4").click(function(){
		$("#tc_xztypzfz").hide();	
	});
});
$('#all').click(function(){
	if(this.checked){                                     
		$("[name='id[]']:checkbox").prop("checked",true);  
	}else{
		$("[name='id[]']:checkbox").prop("checked",false);  
	}	
});
function del() {
	var vars = $("#form_data_scwf").serialize();
	ui_confirm('确定要删除吗?',function(){
	sendAjax("{:U('del')}", vars, function(data) {
	if (data.status) {
		ui_alert(data.info,function(){
			$("input[name='id[]']:checkbox:checked").each(function() {
			$(this).parents("li").remove();
					});
				});				
			}
		});
	});
}
$(".change_dept_simple").change(function(){
	var pid=$(this).val();
	$.ajax({
		type: "post",
		url: "{:U('ajax_get_dept_simple')}",
		data:{pid:pid},
		dataType: "json",
		success:function(result){
			$(".change_pos_simple").html(result);
			
		}
	})
})
$(".change_dept").change(function(){
	var pid=$(this).val();
	$.ajax({
		type: "post",
		url: "{:U('ajax_get_dept')}",
		data:{pid:pid},
		dataType: "json",
		success:function(result){
			$("#tc_xztypz .content1").html(result);
			
		}
	})
})
$(".change_pos").change(function(){
	var dep_id=$(this).val();
	$.ajax({
		type:'post', 
		url: "{:U('ajax_get_pos')}",
		data:{dep_id:dep_id},
		dataType: "json",
		success: function(result){
			$(".get_pos").html(result);
		},
		error:function(e){
		}
	});
})
$(".change_pos_simple").change(function(){
	var dep_id=$(this).val();
	$.ajax({
		type:'post', 
		url: "{:U('ajax_get_pos')}",
		data:{dep_id:dep_id},
		dataType: "json",
		success: function(result){
			$(".get_pos_simple").html(result);
		},
		error:function(e){
		}
	});
})
function show2(id,company_id,dept_id,pos_id,remark,dept){
	$("#typz_id").val(id);
	$("#dept_name_multi_data2").val(dept_id);
	$("#dept_name_multi2").val(dept);
	$("#change_dept option").each(function(){
		if($(this).val() == company_id){
			$(this).prop('selected','true');
		}
	})
	$.ajax({
		type:'post', 
		url: "{:U('ajax_get_dept')}",
		data:{pid:company_id,dept_id:dept_id},
		dataType: "json",
		success: function(result){
			$("#tc_xztypzbj .content1").html(result);
			
			/* $("#change_pos").html(result);
			$("#change_pos option").each(function(){
				if($(this).val() == dept_id){
					$(this).prop('selected','true');
				}
			}) */
		},
		error:function(e){
		}
	});
	$.ajax({
		type:'post', 
		url: "{:U('ajax_get_pos')}",
		data:{dep_id:dept_id},
		dataType: "json",
		success: function(result){
			$("#get_pos").html(result);
			$("#get_pos option").each(function(){
				if($(this).val() == pos_id){
					$(this).prop('selected','true');
				}
			})
		},
		error:function(e){
		}
	});
	 
	$("#typz_remark").val(remark);
}
function save(){
	var id=$("#typz_id").val();
	var company_id=$("#change_dept").val();
	var dept_id=$("#dept_name_multi_data2").val();
	var pos_id=$("#tc_xztypzbj #get_pos").val();
	var remark=$("#typz_remark").val();
	$.ajax({
		type: "post",
		url: "{:U('edit')}",
		data:{id:id,company_id:company_id,dept_id:dept_id,pos_id:pos_id,remark:remark},
		dataType: "json",
		success:function(result){
			if(result.data){
				ui_alert("编辑成功",function(){
					location.reload();
				});
			}else{
				ui_alert('编辑失败',function(){
					location.reload();
				});	
			}
		}
	})
}
function set_version(id,company_id,dept_id,pos_id,type){
	$.ajax({
		url:"{:U('update_version')}",
		data:{id:id,company_id:company_id,dept_id:dept_id,pos_id:pos_id,type:type},
		type:'post',
		success:function(data){
			ui_alert(data.info,function(){
				location.reload();
			});
		},
		error:function(e){
			ui_alert("系统发生错误",function(){
			});
		}
	});
}
$(function(){
    var M1 = $('.aa')
    M1.on('click',function(e){e.stopPropagation();})
    .find('div[class="content1"]').on('click',function(){
        M1.find('.content2').show();
    });
    $(document).on('click',function(){
    	M1.find('.content2').hide();
    })
})
function check() {
    var str=document.getElementsByName("box");
    var objarray=str.length;
    var chestr="";
    for (i=0;i<objarray;i++) {
        if (str[i].checked == true) {
            chestr += str[i].value + ",";
        }
    }
    $(".w").val(chestr)
}
function show(type){
	var s = '';
	var data = '|';
	if(type == 'add'){
		$('#tc_xztypz div[class="content1"] input[type="checkbox"]:checked').each(function(){
			s += $(this).attr('name2')+';';
			data += $(this).val()+'|';
	    });
		$("#tc_xztypz #dept_name_multi").val(s);
		$("#tc_xztypz #dept_name_multi_data").val(data);
	    $('#tc_xztypz .content2').hide();
	}else if(type == 'edit'){
		$('#tc_xztypzbj div[class="content1"] input[type="checkbox"]:checked').each(function(){
			s += $(this).attr('name2')+';';
			data += $(this).val()+'|';
	    });
		$("#tc_xztypzbj #dept_name_multi2").val(s);
		$("#tc_xztypzbj #dept_name_multi_data2").val(data);
	    $('#tc_xztypzbj .content2').hide();
	}
	
    
    $.ajax({
		type:'post', 
		url: "{:U('ajax_get_pos')}",
		data:{dep_id:data},
		dataType: "json",
		success: function(result){
			$(".get_pos").html(result);
			/* $(".get_pos option").each(function(){
				if($(this).val() == pos_id){
					$(this).prop('selected','true');
				}
			}) */
		},
		error:function(e){
		}
	});
}
function cancel(){
	$('.content2').hide();
}
</script>