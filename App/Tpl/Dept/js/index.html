<script type="text/javascript">
$.fn.toggle = function( fn, fn2 ) {
    var args = arguments,guid = fn.guid || $.guid++,i=0,
    toggle = function( event ) {
      var lastToggle = ( $._data( this, "lastToggle" + fn.guid ) || 0 ) % i;
      $._data( this, "lastToggle" + fn.guid, lastToggle + 1 );
      event.preventDefault();
      return args[ lastToggle ].apply( this, arguments ) || false;
    };
    toggle.guid = guid;
    while ( i < args.length ) {
      args[ i++ ].guid = guid;
    }
    return this.click( toggle );
} 

function wli(){
	var wsp0=0;
	var wsp=$('.content_div,.content_div1').children('span');
	for( var i=0; i<wsp.length;i++){
		wsp0+=wsp.eq(i).outerWidth();
	}
	$('.content_div1,.content_div2').css('width',wsp0);	
}
wli();

$(".content_div2 img").each(function(){
	$(this).click(function(){
		if($(this).parent().parent().children('ul').is(":hidden")){
			$(this).parent().parent().children('ul').show()
			$(this).attr('src','__PUBLIC__/img/ajj.png');
		}else{
			$(this).parent().parent().children('ul').hide()
			$(this).attr('src','__PUBLIC__/img/add.png');
		}
	})
	/* $(this).toggle(function(){
		$(this).parent().parent().children('ul').show()
		$(this).attr('src','__PUBLIC__/img/ajj.png');
	},function(){
		$(this).parent().parent().children('ul').hide()
		$(this).attr('src','__PUBLIC__/img/add.png');
	}) */
})
//添加
$('.img_tj').click(function(){
	$.ajax({
		type:'post',
		url:"{:U('get_company_candidate')}",
		success:function(data){
			$("#company").html(data);
		}
	})
	
	$('#tc_tj').show();	
	$('.bottom_sp3').click(function(){
		$('#tc_tj').hide();	
	})
	$('.bottom_sp4').click(function(){
		window.onbeforeunload = null;
		if (check_form("form_data_company_add")) {
			sendForm("form_data_company_add", "{:U('company_add')}");
		}
	})
})

//新增子部门
function add_child_dept(dept_id){
	$.ajax({
		type:'post',
		data:{dept_id:dept_id},
		async:false,
		url:"{:U('ajax_get_dept_info')}",
		success:function(data){
			//alert(JSON.stringify(data));
			$("#belong_company").html(data.info.company_name);
			$("#belong_dept").html(data.info.name);
			$("#belong_dept_id").val(data.info.id);
		}
	});
	validate();
	$('#tc_xzz').show();	
	$('.bottom_sp3').click(function(){
		$("#dept_name").val('');
		$("#dept_no").val('');
		$('#tc_xzz').hide();	
	})
	$('.bottom_sp4').click(function(){
		window.onbeforeunload = null;
		if (check_form("form_data_dept_add")) {
			sendForm("form_data_dept_add", "{:U('dept_add')}");
		}
	})
}
/* $('#a1_3').click(function(){
	
}) */
function set_use(dept_id,is_use){
	$.ajax({
		type:'post',
		data:{id:dept_id,is_use:is_use},
		url:"{:U('set_dept')}",
		success:function(data){
			//alert(JSON.stringify(data));
			//alert(data.res);
			if(data.res == '1'){
			//	alert(data.is_use);
				if(data.is_use == '1'){
					$("#a0_"+dept_id).html('启用');
					$("#a0_"+dept_id).css('font-weight','normal');
					$("#a1_"+dept_id).html('禁用');
					$("#a1_"+dept_id).attr('onclick','set_use("'+data.dept_id+'","0")');
				}else{
					$("#a0_"+dept_id).html('禁用');
					$("#a0_"+dept_id).css('font-weight','bold');
					$("#a1_"+dept_id).html('启用');
					$("#a1_"+dept_id).attr('onclick','set_use("'+data.dept_id+'","1")');
				}
				
			}
		},
		error:function(){
			alert('操作失败');
		}
	})
}
function validate(){
    $.formValidator.initConfig({formID:"form_data_dept_add",debug:false,submitOnce:true,
        onError:function(msg,obj,errorlist){
       		alert(msg);
    	},
    	submitAfterAjaxPrompt : "正在进行校验，请稍候"
	});
    var id = $("#id").val();
    var belong_dept_id = $("#belong_dept_id").val();
    $("#dept_name").formValidator({
        tipID:"dept_nameTip",
        empty:false,
        onShow:" ",
        onFocus:" ",
        onCorrect:"<span style='color:green;'>√</span>"
    }).inputValidator({
        min:1,max:255,
        onErrorMin:"部门名称不能为空",
        onErrorMax:"部门名称超过最大长度"
    });
    $("#dept_name").ajaxValidator({
    	dataType : "json",
        type : "GET",
		isValid : true,
        async : false,
        data:{id:id,belong_dept_id:belong_dept_id},
        url : "{:U('validate')}",
        success : function(data){
            if( data.status == 1 ) return false;
            if( data.status == 0 ) return true;
            return false;
        },
        error: function(jqXHR, textStatus, errorThrown){alert("服务器没有返回数据，可能服务器忙，请重试"+errorThrown);},
        onError : "已存在该部门名称",
        onWait : "正在对部门名称进行合法性校验，请稍候"
    });
}
</script>
